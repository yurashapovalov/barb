# ADR-005: Данные ответов в jsonb, не в Storage

## Контекст

Каждый ответ модели может содержать структурированные данные (таблицы, результаты запросов). Нужно было решить где хранить эти данные.

## Решение

Колонка `data` (jsonb) в таблице `messages`. Данные хранятся рядом с сообщением.

## Почему так

- Данные маленькие: типичный результат запроса — 1-50 строк, до 5KB в JSON
- Один запрос = сообщение + данные. Не нужен отдельный JOIN или fetch из Storage
- jsonb поддерживает индексы и запросы если понадобится аналитика
- Простота: нет отдельного lifecycle для файлов в Storage

## Альтернативы

- Supabase Storage (S3) — файлы с данными, ссылка в messages
- Отдельная таблица `message_data` с нормализованной структурой
- Хранить только в памяти, не персистить (фронт запрашивает заново)

## Последствия

- При 1000 юзеров × 20 сообщений/день × 5KB ≈ 100MB/день. Приемлемо
- Если данные вырастут (графики, большие таблицы) — пересмотрим в сторону Storage
- TTL cleanup можно добавить позже для старых сообщений
