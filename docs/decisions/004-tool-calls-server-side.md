# ADR-004: Tool calls выполняются на сервере

## Контекст

Gemini использует function calling для запросов к данным. Нужно было решить где выполняется код tool calls — на сервере (Python) или на клиенте (через function calling API).

## Решение

Все tool calls выполняются на сервере в Python. Gemini описывает какую функцию вызвать, API выполняет её, результат возвращает Gemini для формирования ответа.

## Почему так

- Данные (parquet) загружены в память на сервере — нет смысла гонять их на клиент
- Python + pandas = естественная среда для аналитических запросов
- Безопасность: клиент не имеет доступа к сырым данным
- Простота: один процесс, нет сетевых round-trips между Gemini → клиент → Gemini

## Альтернативы

- Gemini function calling → фронт выполняет → отправляет результат обратно
- Гибрид: простые запросы на сервере, визуализация на клиенте

## Последствия

- Tool call результаты не попадают в контекст Gemini (экономим токены)
- Результаты сохраняются в DB (messages.data, tool_calls) для отображения на фронте
- Фронт получает готовые данные, не вычисляет сам
