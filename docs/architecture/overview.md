# Архитектура Barb

Торговый аналитический ассистент. Пользователь задаёт вопрос на естественном языке — получает ответ с данными.

## Слои

```
Пользователь
    ↓
Frontend (React + Supabase)     — UI, авторизация, история чатов
    ↓ JWT
API (FastAPI)                   — валидация токена, маршрутизация
    ↓
Assistant (Gemini + tools)      — LLM думает, вызывает инструменты
    ↓
Query Engine (barb/)            — детерминированное выполнение запросов
    ↓
Data (Parquet)                  — минутные OHLCV данные
```

## Принципы

- **LLM — мозг, Query Engine — руки.** LLM решает что считать, Query Engine считает. Никакого произвольного кода — только JSON-запросы через фиксированный пайплайн.
- **Stateless API.** Клиент шлёт полную историю каждый запрос. Сервер ничего не хранит между запросами.
- **Конфиг, не код.** Инструменты, сессии, праздники, модели — всё в config/. Промпт строится из конфига, не захардкожен.
- **Frontend хранит данные.** Чаты и сообщения живут в Supabase. API только обрабатывает запросы.

## Модули

- [Query Engine (barb/)](./query-engine.md) — пайплайн обработки запросов
- [Assistant (assistant/)](./assistant.md) — LLM + tool calling
- [API (api/)](./api.md) — HTTP слой
- [Config (config/)](./config.md) — конфигурация инструментов, моделей, рынка
- [Frontend (front/)](./frontend.md) — React приложение
- [Инфраструктура](./infrastructure.md) — деплой, CI, Docker
